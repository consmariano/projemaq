\documentclass[twoside,a4paper]{refart}
\usepackage{makeidx}
\usepackage{ifthen}
% ifthen wird vom Bild von N.Beebe gebraucht!

\def\bs{\char'134 } % backslash in \tt font.
\newcommand{\ie}{i.\,e.,}
\newcommand{\eg}{e.\,g..}
\DeclareRobustCommand\cs[1]{\texttt{\char`\\#1}}

\title{Manual de Operação Linux CNC}
\author{Grupo 2 - Projeto de Máquina PMR3411 - 2024 \\
Vinicios de Andrade Cardozo \\
Gabriel Silva de Carvalho  \\
Douglas \\
Version 1}

\date{}
\emergencystretch1em  %

\pagestyle{myfootings}
\markboth{Changing the layout with \textrm{\LaTeX}}%
         {Changing the layout with \textrm{\LaTeX}}

\makeindex 

\setcounter{tocdepth}{2}

\begin{document}

\maketitle

\begin{abstract}
Por meio deste texto vamos apresentar de maneira resumida a operação básica do torno controlado pelo Linux CNC, levando em conta peculiaridades presentes no controlador em relação a outras opções mais comuns e também as advindas de escolhas que ficaram a cargo do grupo de programação do projeto.
\end{abstract}

\tableofcontents

\newpage


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Procedimentos inicias}

Aqui trataremos dos passos iniciais para começar a operar a máquina, ou seja, passos a serem realizados antes mesmo que o botão de ligar seja ativado na interface gráfica do aplicativo do LinuxCNC. 

\subsection{Inicialização e login}

Antes de ligar o computador é recomendável verificar que o Joystick esteja acoplado em uma entrada USB, uma vez que o LinuxCNC pode apresentar problemas de varredura de periféricos, ou seja, ele pode não detectar disposivos conectados após sua inicialização (apesar de que esse problema nunca se apresentou para o caso de pendrives).

O próximo passo é conectar a caixa de controle a \textbf{uma tomada de 220V} (na sala de laboratório essas tomadas tem cor vermelha), e então ligar a caixa. Note que a caixa deve ser ligada antes de se ligar o computador pelo mesmo problema de varredura anteriormente citado.

Com os passos anteriores feitos, o computador pode ser ligado. Para acessa-lo basta que se entre com o login: \textbf{alunopmr} e a senha: \textbf{pmrcnc}. 

A última coisa a se fazer antes de se abrir o aplicativo do LinuxCNC é abrir um terminal e executar o comando: \textbf{qjoypad} para inicializar a aplicação que irá receber os inputs do Joystick e convertelos para comandos de teclado que o LinuxCNC comprende. 

\subsection{Preparação para carregar um código G}

Já com o aplicativo do LinuxCNC aberto, procure pelo botão vermelho de ligar no canto superior esquerdo da interface gráfica ou simplesmente utilize o botão "start" do Joystick, isso irá efetivamente ligar a máquina. 

Com o controle manual (Joystick ou teclado) leve o torno para uma posição segura e então faça o \textbf{homing} dos eixos X e Z.

Para códigos G que descrevem diâmetros ao invés de raios (ou seja, códigos G usuais) é preciso que se ative o modo de diâmetro usando o comando G7 no MDI.

Abra o código G da peça que você deseja produzir. Se houver algum erro na abertura modificações no código podem ser necessárias.

\section{Definição do zero peça}

O zero peça é a referência relativa ao zero máquina que passamos ao LinuxCNC para que o mesmo saiba em que coordenadas o material bruto que deve ser torneado está localizado. Podem ser definidos, através de diferentes códigos G, diversos planos de corte, sendo o P0 o plano padrão, em coordenadas absolutas definidas na etapa de homing da máquina.

Para definir o zero peça devemos definir um novo plano de corte utilizando a função de \textbf{apalpador} localizada ao lado do botão de homing. Apesar de não ser obrigatório, dê preferência a definir o zero peça usando o plano definido por G54. A seguir, uma breve descrição do como usar a função do apalpador para definir o zero peça em cada um dos eixos.

\subsection{Eixo Z}

Leve a ferramenta até a face do tarugo e econste nela com \textbf{cuidado}, utilizando de preferência o d-pad do Joystick (o teclado também funciona, mas utilizar o Joystick é parte da avaliação). 

Confira se o eixo Z aparece selecionado antes de prosseguir, se não estiver seleione-o de um dos seguintes modos: clicando na opção com o mouse, mudando para o eixo Z usando o L2 do Joystick (recomendado) ou ainda usando o atalho de teclado Z (z maiúsculo).

Clique em apalpador, mantenha o offset em 0, selecione o plano de corte desejado (por favor use o G54 como o padrão para essa operação), clique em "OK". Isso deve mover a imagem da peça na tela, para a nova posição Z que você indicou através desse procedimento.

\attention Use o bom senso ao fazer esse procedimento, controlando a velociade de aprocimação usando os triggers superiores do controle para aumentar ou diminuir a velocidade (L1 diminui a velociade e R1 aumenta). Consulte o slider na interface gráfica com o nome de "Jog speed" para ver a velocidade com a qual você está avançando (o slider pode ser usado para controlar essa velocidade também, mas novamente é recomendável o uso do Joystick). 

\attention Recomendamos velocidades de aproximação baixas (20 a 50 mm/s) quando prestes a encostar no tarugo de material.

\subsection{Eixo X}

Para esse eixo é preciso conhecer o diâmetro do tarugo que vai ser torneado. Idealmente deve-se fazer um passo manual de desbaste para garantir um diâmetro uniforme ao longo de todo comprimento do tarugo.

De pose dessa informação, leve a ferramenta até a leteral do tarugo e encoste nela com \textbf{cuidado}, utilizando de preferência o d-pad do Joystick (o teclado também funciona, mas utilizar o Joystick é parte da avaliação). 

Confira se o eixo X aparece selecionado antes de prosseguir, se não estiver seleione-o de um dos seguintes modos: clicando na opção com o mouse, mudando para o eixo X usando o R2 do Joystick (recomendado) ou ainda usando o atalho de teclado X (x maiúsculo).

Clique em apalpador, o offset que você deve informar é o diâmetro (assumindo que G7 foi ativado, se não, o raio) do tarugo que você está prestes a tornear, selecione o plano de corte desejado (por favor use o G54 como o padrão para essa operação), clique em "OK". Isso deve mover a imagem da peça na tela, para a nova posição X que você indicou através desse procedimento.

\attention Use o bom senso ao fazer esse procedimento, controlando a velociade de aprocimação usando os triggers superiores do controle para aumentar ou diminuir a velocidade (L1 diminui a velociade e R1 aumenta). Consulte o slider na interface gráfica com o nome de "Jog speed" para ver a velocidade com a qual você está avançando (o slider pode ser usado para controlar essa velocidade também, mas novamente é recomendável o uso do Joystick). 

\attention Recomendamos velocidades de aproximação baixas (20 a 50 mm/s) quando prestes a encostar no tarugo de material.

\subsection{Testando o zero peça}

Se por alguma razão você estiver em dúvida sobre se o zero peça está defido no lugar certo (centro da face frontal do tarugo), você tem duas opções, refazer a calibração (recomendado), ou usar um comando no MDI para mandar a ferramenta para a coordenada (0, 0) definida em relação a G54 (tome muito cuidado).

Partindo de uma posição segura (ou seja, onde o movimento da ferramenta não tem chance de colidir com o tarugo), um comando como G54 G01 X0. Z0. F100. pode ser executado e se você definiu o zero peça corretamente, não devem haver problemas

\attention Se um procedimento como esse for executado, tenha certeza que você entende o que o comando que você digitar no MDI faz. Além disso, evite velocidades mais altas que a apresentada no exemplo.

\attention Fique atento, se a ferramenta colidir com o tarugo e não parar, esteja pronto para apertar o botão vermelho de emergência localizado na caixa de controle. É melhor ainda se houver outra pessoa pronta para apertar o botão enquanto você manuseia a máquina. 

\subsection{Input files and class files}

According to the principle of separation of content and design, 
there are two kind of files:

\begin{itemize}
\item
        The content and the logical structure of a document are defined in 
        the \LaTeX\ input file.
\item
        The design (layout) is defined in the class files and packages.
\end{itemize}
Which class and packages files a document will use is defined at the 
beginning of the input file.  The \verb|\documentclass| command 
selects the class and the \verb+\usepackage+ command specifies 
additional packages.

To generate a paper you need at least two files, the input file and a 
class file.

These two files represent the work of the author and designer as 
explained in the introduction. Even if the author and the designer are 
the same person, this has some advantages:

\begin{itemize}
\item
        Similar documents (that appear in a series) have the same layout 
        because the layout is defined in a file of its own and not part of 
        the document.
\item
        You can print the same contents without much work in different 
        layouts, \eg\ as an article for a magazine and as a chapter for a 
        dissertation.
\end{itemize}

\subsection{Class files and Packages}

\LaTeX\ supports a hierarchy of layout definitions.
\begin{itemize}
\item
        The first file processed is the class file that is specified inside 
        the curly braces of the \verb|\documentclass| command. This 
        defines the kind of document you want to write. 
\item
        The optional argument of the \verb|\documentclass| command inside 
        the square brackets defines class options which select variants of 
        the basic layout,such as different font sizes.
\item
        The last step is reading the packages specified by the 
        \verb|\usepackage| command. This command again takes options to 
        select the layout.
\item
        You can change layout parameters in the input file, but this is 
        discouraged because it violates the principle of separation of 
        content and design.

\end{itemize}

There are some important differences between class and package files 
and ``normal'' input files:
\begin{itemize}
\item
        Class and package files should only contain definitions. They must 
        not output text.
\item
        The ``at''-sign \texttt{@} is treated as a letter and therefore may 
        appear in command names. Most internal commands of \LaTeX\ contain 
        an \texttt{@} to prevent the author from using them accidentally.
\item
        The extension of the file is \texttt{.cls}, \texttt{.clo} or 
        \texttt{.sty} instead of \texttt{.tex}.
\end{itemize}

\subsection{Changing the layout, step by step}
\index{changing the layout, step by step}

It is usually easier to change existing class files instead of 
writing a new one from scratch. In many cases it is even sufficient 
so replace some definitions and put them into a package instead of 
creating a new class.

Please note that you are \emph{not} allowed to change the standard 
classes distributed with \LaTeX. You \emph{have} to change the name 
when you want to make changes. That is another reason to put small 
changes in packages.

\subsubsection{Defining the differences between the desired  and 
the available layout}

The first step is to define the difference between the layout you have 
and the layout you want. 

\subsubsection{Finding the original definition}

The next step is to find out where the original layout is defined.  It 
is best to search the files in the following order:\footnote{This hint 
came from Sue Brooks, who held a workshop for ``\LaTeX-Hacker'' at the 
1988 \TeX-conference in Exeter.}
\begin{enumerate}
\item the \LaTeX\ manual by Leslie Lamport,
\item the \LaTeX\ documentations files \texttt{*.dtx} for the classes 
or packages
\item the \LaTeX\ documentations files \texttt{*.dtx} for the kernel,
\item the \TeX book by Donald E.~Knuth.
\end{enumerate}

The files are usually documented quite well so you should be able to 
change things even if you don't understand everything.


\subsubsection{Writing a new package file}

The third step is to create a new package. You choose an appropriate 
name for the package (like \texttt{mysty}) and create a filename by 
adding the extension \texttt{.sty}.

This file will only contain the definitions you want to change or the 
new commands you want to define.

If you want to change definitions or certain parameters, the best way 
is to copy them from the original file and modify them according to 
your liking.

Defining new commands is easier when you find similar commands in the 
original files which you can change.

It is always a good idea to include the reason you wrote the package, 
the changes it makes and the new commands it defines in the file. You 
should include the date of the last change and the \LaTeX\ version it 
works with, just in case some internal \LaTeX\ commands you use will change.

When writing larger packages, it is an even better idea to use the 
\texttt{docstrip} program which is used to document the \LaTeXe\ files.  Thus 
you have your code and documentation in one file and it's easier to 
keep them from going out of sync.

\subsubsection{Using the new package}

To use the new package, you call it with the \verb|\usepackage| command. 
This command executes the code of your package and changes the layout 
as desired.

Example:

\begin{verbatim}
   \documentclass[11pt,twoside,a4paper]{article}
   \usepackage{mysty} %<- This calls the package "mysty"
\end{verbatim}

You shouldn't need to change anything else in your input file, unless 
you defined new commands or environments that are not available in 
standard \LaTeX.

\attention
When you copy your input file to a different computer you have to 
include your new packages as well. Otherwise the document can't be 
processed.

%%%%%%     %%%%%%%%%%      %%%%%%%%%%        %%%%%%%%%%        %%%%%%%%%

\subsection{A simple example (Equation numbers)}

Let's assume that you want to write an article where the equations are 
numbered separately in every section. In the \LaTeX\ manual you find a 
notice that the report class does something similar for every chapter.

Looking into the file \texttt{report.cls} you will find the following 
commands that deal with equation numbers:\nopagebreak
\begin{verbatim}
   \@addtoreset{equation}{chapter}
   \def\theequation{\thechapter .\arabic{equation}}
   % or in LaTeX2e since 1995/06/01:
   \renewcommand\theequation{
                \thechapter.\@arabic\c@equation
                                }
\end{verbatim}

You don't necessarily need to understand these two commands in detail.

Now you create an new file with the name 
\texttt{eqpersec.sty}\footnote{Depending on the computer you are using 
the name may be different like \texttt{EQPERSEC\_STY} on a CYBER 
running NOS/VE. But note that you must not use spaces in the 
filename.} and copy the commands above into that file.  After that 
you replace every occurrence of \texttt{chapter} with \texttt{section} 
and add some comments.\nopagebreak
\begin{verbatim}
   % This is equation_per_section.sty
   % Short name: eqpersec.sty
   % Original file by Hubert Partl 1988
   % Modified by Axel Kielhorn 1996/01/01
   % to support LaTeX 1995/06/01 and later
   %
   % reset the equation counter at the start
   % of a new section 
   % 
   \@addtoreset{equation}{section}
   % Equationnumber = sectionnummer.equationnummer
   % Use only one of the below 
   % depending on you LaTeX version
   % 
   %\def\theequation{\thesection .\arabic{equation}}
   % or in more recent versions of LaTeX
   \renewcommand\theequation{
                \thesection.\@arabic\c@equation
                                }
\end{verbatim}


Whenever you use a \verb|\usepacakge{eqpersec}| command as in
\nopagebreak
\begin{verbatim}
\documentclass[11pt]{article}
\usepackage{eqpersec}
\end{verbatim}
you will get equations numbered according to your conventions.


%%%%%%%%%% %%%%%%%%%%%%%% %%%%%%%%%%%% %%%%%%%%%%%% %%%%%%%% %%%%%%%%%%%%

\subsection{A more complex example (Reference Manual)}
\label{refmanex}

We want to create a layout similar to the one used in the \textit{PostScript 
Reference Manual}, with a wide left margin for headings and margin 
notes and a small margin at the right and bottom.

\subsubsection{Page layout}

To define the new layout we use the commands described in the \LaTeX\ 
manual. For full details see the file \texttt{refman.dtx}.

%\pagebreak[2]

\marginlabel{Horizontal:}
First we define two new names for length that we will use often:

\cs{fullwidth} is the width of the whole page minus a margin of 1~inch 
on every side. 
%
\begin{displaymath}
\texttt{fullwidth} = \texttt{paperwidth} - 2\ \textrm{inch}
\end{displaymath}
%
From this the width of the text is calculated.
%
\begin{displaymath}
\texttt{textwidth} = \texttt{fullwidth} \times \texttt{textfraction}
\end{displaymath}
%
\cs{leftmarginwidth} is the width of the left margin that will be 
used for headings and margin notes. 
\begin{displaymath}
\texttt{leftmarginwidth} = \texttt{fullwidth} - \texttt{textwidth}
\end{displaymath}
%
This is a little more difficult in reality because the lengths have to 
be rounded to full points and a possible two column layout -- as used 
in the index -- must be taken into consideration.

\marginlabel{Vertical:}
The vertical layout is a little more difficult because you have to 
deal with the page header and footer. 
%
\begin{displaymath}
\texttt{textheight} = \texttt{paperheight} - 2.5\ \textrm{inch}
\end{displaymath}
%
The result of this calculation is rounded to full lines. Depending on 
the page style -- headings or footings -- it is shifted up or down by one 
line.

\vspace{0pt plus 1cm}

\subsubsection{Section headings}

The headings have to be modified to make them extend into the left 
margin.

In file \texttt{classes.dtx} we find the \verb|\@startsection| command 
that defines the layout of the headings. Only parameters 4 to 6 are 
relevant for us: parameter 4 is the space above and parameter 5 the 
space below the section. The 6th parameter does the actual formatting.

This is the original definition:\nopagebreak
\begin{verbatim}
\newcommand\section{\@startsection
             {section}{1}{\z@}%
             {-3.5ex plus -1ex minus -.2ex}%
             {2.3ex plus .2ex}%
             {\normalfont\Large\bfseries}}
\end{verbatim}

The commands for sub- and subsubsections are similar. Note that the 
measures are all in \texttt{ex}, thus depending on the font size used.

We define a new command \cs{secshape} to format the headings. This 
command uses the whole width of the page for the heading. To discourage 
hyphenation of the heading we give it a high penalty. This still 
allows hyphenation when absolutely necessary.

\begin{verbatim}
\newcommand\secshape{%
               \leftskip=-\leftmarginwidth%
               \rightskip=\@flushglue%
               \hyphenpenalty=2000}
\end{verbatim}

This command is inserted into the 6th parameter of \verb|\@startsection|.

Since the headings now extend into the left margin, we can use a 
smaller font and reduce the space between the text and the heading. The 
new definition looks like the following:\nopagebreak
\begin{verbatim}
\newcommand\section{\@startsection
             {section}{1}{\z@}%
             {-2ex plus -1ex minus -.2ex}%
             {0.5ex plus .2ex}%
             {\secshape\normalfont\large\bfseries}}
\end{verbatim}

\vspace{0pt plus 1cm}

\subsubsection{Setting the margin notes}

The margin notes should always appear on the left side of the text. 
The normal layout puts them into the outer margin in twoside layout.

The file \texttt{latex.dtx} contains the definition of the 
\verb|\@addmarginpar| command which is responsible for the margin 
notes. We don't have to understand the whole definition; the important 
part is the internal variable \verb|\@tempcnta| that is either 
\verb|\@ne| (1) when the note should appear on the right side of the 
text or \verb|\m@ne| ($-1$) when it should appear on the left side.

This is done by the following lines:
\begin{verbatim}
    \@tempcnta\@ne
    \if@twocolumn
        \if@firstcolumn \@tempcnta\m@ne \fi
    \else
      \if@mparswitch
         \ifodd\c@page \else\@tempcnta\m@ne \fi
      \fi
      \if@reversemargin \@tempcnta -\@tempcnta \fi
    \fi
\end{verbatim}

which we simply replace by:
\begin{verbatim}
    \@tempcnta\m@ne
\end{verbatim}

The remaining lines that handle the setting of the margin note 
depending on the parameter \verb|\@tempcnta| are left unchanged.

\subsubsection{Extensions}

The definitions described above are sufficient for simple applications 
but in practical use one may want some additional commands.  
\seealso{Appendix \ref{refman}} You will find the description for the whole new 
class in the appendix~\ref{refman}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input lay_e2

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\printindex

\end{document}
